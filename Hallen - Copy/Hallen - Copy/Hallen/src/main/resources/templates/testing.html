<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Rent Multiple Felder Test</title>
</head>
<body>
    <h1>Rent Multiple Felder Test</h1>
    <button id="testBtn">Run Test</button>
    <pre id="output"></pre>

    <script>
        async function runTest() {
            const output = document.getElementById("output");
            output.textContent = "Fetching feld IDs...\n";

            try {
                // Step 1: Get feld IDs from the API
                const feldRes = await fetch("http://localhost:8080/api/feld/getByHallenId/9");
                const felder = await feldRes.json();
                output.textContent += `Got felder: ${JSON.stringify(felder, null, 2)}\n`;

                // Step 2: Extract feld IDs
                const feldIds = felder.map(f => f.id);
                output.textContent += `Extracted feld IDs: ${feldIds.join(", ")}\n`;

                // Step 3: Build RentMultipleFelderRequest
                const requestPayload = {
                    feldIds: feldIds,
                    mieterId: 32,
                    anlass: "Test Anlass " + Math.floor(Math.random() * 1000),
                    anfang: new Date().toISOString(),
                    ende: new Date(Date.now() + 60 * 60 * 1000).toISOString() // +1 hour
                };
                output.textContent += `Request payload: ${JSON.stringify(requestPayload, null, 2)}\n`;

                // Step 4: Send POST request
                const rentRes = await fetch("http://localhost:8080/api/termine/mieten/multipleFelder", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(requestPayload)
                });

                const rentData = await rentRes.json();
                output.textContent += `\nServer response:\n${JSON.stringify(rentData, null, 2)}`;
            } catch (err) {
                output.textContent += `Error: ${err}`;
            }
        }

        document.getElementById("testBtn").addEventListener("click", runTest);
    </script>
</body>
</html>
